<HTML>
<HEAD>
<LINK REL="stylesheet" HREF="photo.css" TYPE="text/css">
<TITLE>Crop Picture</TITLE>
<STYLE>
.PreviewFull
{
    background-color: #B8DEF9;
    width:  100%;
    height: 100%;
    margin: 2;
}

<!-- Gray out beta2 functionality -->
<!-- Fix onclick and add HREF="" to items below -->
#beta2_instant,
#beta2_redeye
{ 
    color : gray; 
    text-decoration : none;
    font-weight : normal;
}
</STYLE>

<!-- BUGBUG: just have one of these -->

<OBJECT ID=Edit CLASSID="CLSID:0f023cae-4468-11d3-822e-00c04f609487"></OBJECT>

<SCRIPT DEFER SRC="photoctr.js"></SCRIPT>
<SCRIPT>

external.event.registerSink("NavBar.Back", OnBack, false);
external.event.registerSink("Place.BeginTransition", OnCropTransition, false);

var L_UndoCrop_Text = "Undo Crop";
var L_Preview_Text = "Preview";

var fPreview = false;

function DoPreview()
{
    if (fPreview == false)
    {
        fPreview = true;
        preview.innerText = L_UndoCrop_Text;
    }
    else
    {
        fPreview = false;
        preview.innerText = L_Preview_Text;
    }

    CropPreview.PreviewMode = fPreview;
}

function DoCrop()
{
    Edit.Start();
    Edit.Crop(window.external.Property("Current Editing Image").Path, "", CropPreview.x, CropPreview.y, CropPreview.cx, CropPreview.cy);
    Edit.Save(savenew.checked);
    GoTo("Main Edit");
}

function InitPage()
{
    var file = window.external.Property("Current Editing Image");
    CropPreview.SetImageFile(file.Path);
    fPreview = true;
    DoPreview();
}

function OnLoad()
{
    CropPreview.bgColor = "#B8DEF9";
    InitPage();
}

function OnCropTransition(From, To)
{
    if (To == "Crop")
    {
        InitPage();
    }
}

function OnBack(From)
{
    if (From == "Rotate")
    {
        Edit.Cancel();
    }
}

</SCRIPT>

</HEAD>

<BODY onload="OnLoad()">

<!-- background image -->

<IMG SRC="images/stripes.gif" CLASS="backgroundimage">

<!-- page content -->
<TABLE CLASS="PageContentTable">
    <TR  CLASS="PageTitleRow">
        <TD CLASS="PageLeftSpacer">&nbsp</TD><TD CLASS="title"><ID id="maintitle">Crop your picture</ID></TD>
    </TR>

    <!-- main content -->
    <TR CLASS="PageContentRow">
        <TD CLASS="PageLeftSpacer">&nbsp</TD>
        <TD CLASS="PageContentCell">
            <TABLE CLASS="ContentDividerTable">
                <TR CLASS="ContentDividerRow">
                    <!-- tasks -->
                    <TD CLASS="LeftContentCell">
                        <TABLE STYLE="height:100%">
                            <TR STYLE="height:50%">
                                <TD>
                                    <SPAN CLASS="textPrimary"><ID id="cmdtitle">To crop your picture:<BR></ID></SPAN><BR>
                                    <TABLE CLASS="textSecondary">
                                        <TR>
                                            <TD id=aaa>1.</TD><TD id="step1">On the right, click the rectangle around your picture and drag it until it surrounds the part of the picture you want to keep.<p></TD>
                                        </TR>
                                        <TR>
                                            <TD id=bbb>2.</TD><TD id="step1a">To see what your cropped picture will look like, click <B>Preview</B>.<p></TD>
                                        </TR>
                                        <TR>
                                            <TD id=ccc>3.</TD><TD id="step2">To save your cropped picture, click <B>Save</B>. <P ID=idText1>If you want to keep a copy of the original version of your picture, select <B>Save as new picture</B>, and then click <B>Save</B>.</P>
                                            </TD>
                                        </TR>
                                    </TABLE>
                                    <P>
                                </TD>
                            </TR>

                            <TR STYLE="height:50%">
                                <TD>
                                <SPAN CLASS="textPrimary"><ID id="also">You can also</ID></SPAN><BR>
                                <SPAN CLASS="textSecondary">
                                    <A ID="beta2_instant"><ID ID=instantfixup>Instant fixup</ID></A><BR>
                                    <A HREF="" onclick="return GoTo('Rotate')"><ID id="also2">Rotate pictures</ID></A><BR>
                                    <A ID="beta2_redeye"><ID ID=redeye>Remove red-eye</ID></A>
                                </SPAN>
                            </TR>
                        </TABLE>
                    </TD>

                    <!-- other content -->
                    <TD ID=PreviewArea CLASS="RightContentCell">
                        <TABLE STYLE="width:100%; height:100%">
                            <TR STYLE="width:100%; height:100%">
                                <TD STYLE="width:100%; height:100%; background-color: #B8DEF9;">
                                    <DIV ID="PreviewFrame" CLASS="PreviewFull">
                                        <OBJECT ID="CropPreview" CLASSID="clsid:761BE819-63F6-4276-A391-706D43605119" STYLE="width: 100%; height: 100%;"></OBJECT>
                                    </DIV>
                                </TD>
                            </TR>
                            <TR STYLE="width:100%;">
                                <TD style="padding-top: 10;">
                                    <TABLE>
                                        <TR>
                                            <TD>
                                                <BUTTON ID="preview" ONCLICK="DoPreview()" STYLE="width: 80;">Preview</BUTTON>
                                            </TD>
                                            <TD>&nbsp;</TD>
                                            <TD>
                                                <BUTTON ID="crop" ONCLICK="DoCrop()" STYLE="width: 80;">Save</BUTTON>
                                            </TD>
                                            <TD>&nbsp;</TD>
                                            <TD>
                                                <BUTTON ID="cancel" ONCLICK="GoTo('Main Edit')" STYLE="width: 80;">Cancel</BUTTON>
                                            </TD>
                                        </TR>
                                    </TABLE>
                                </TD>
                            </TR>
                            <TR STYLE="width:100%;">
                                <TD>
                                    <TABLE>
                                        <TR>
                                            <TD>
                                                <INPUT ID="savenew" TYPE="CHECKBOX" NAME="savenew" VALUE="savenew">
                                            </TD>
                                            <TD>
                                                <LABEL CLASS="textSecondary" FOR="savenew"><FONT COLOR="Black"><ID id="saveasnew">Save as new picture</ID></FONT></LABEL>
                                            </TD>
                                        </TR>
                                    </TABLE>
                                </TD>
                            </TR>
                        </TABLE>
                    </TD>
                </TR>
            </TABLE>
        </TD>
    </TR>
</TABLE>
</BODY>
</HTML>
