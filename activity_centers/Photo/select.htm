<HTML>
<HEAD>
<LINK REL="stylesheet" HREF="photo.css" TYPE="text/css">
<TITLE>Select Pictures Place</TITLE>
<SCRIPT DEFER SRC="photoctr.js"></SCRIPT>
<SCRIPT DEFER SRC="..\common\itemlist.js"></SCRIPT>
<SCRIPT>
    var L_SelectSomePics_Text = "You have not selected any pictures.  Please select some pictures before continuing.";
    var g_bInited = false;  // true if we have restored selection

    external.event.registerSink("Place.BeginTransition", OnBeforePlaceTransition, false);
    external.event.registerSink("Place.TransitionComplete", OnAfterPlaceTransition, false);
    
    function OnBeforePlaceTransition(From, To)
    {
        if (From == "Select Pictures")
        {
            var i;
            var items = external.Property("Selected Items");

            if (items)
            {
                var sel = WebBrowser.Document.SelectedItems();
                for (i=0; i < sel.Count; i++) // >
                {
                    items.Add(sel.Item(i));
                }
            }

            g_bInited = false;
        }
    }

    function OnAfterPlaceTransition(From, To)
    {
        // choose folder and view pictures are going to navigate the webbrowser
        // so we'll do restore selection on doccomplete below
        if (To == "Select Pictures" && From != "Choose Folder" && From != "View Pictures")
        {
            RestoreSelection();
        }
    }

    function RestoreSelection()
    {
        if (g_bInited)
            return;
            
        var doc = WebBrowser.Document;
        var folder = doc.Folder;

        if (folder)
        {
            var items;
            var i;
            var path = folder.Self.Path;

            items = external.Property("Selected Items");
            if (!items)
            {
                items = new ItemList();

                external.Property("Selected Items") = items;
            }

            for (i=items.Count()-1; i >= 0; i--)
            {
                var item = items.Item(i);
                if (item.Parent.Self.Path == path)
                {
                    doc.SelectItem(item, 1); //SVSI_SELECT = 1
                    items.Remove(i);
                }
            }

            g_bInited = true;
        }
    }
    
    function SelectAll()
    {
        WebBrowser.Document.SelectItem(null, 1);
    }

    function UnselectAll()
    {
        WebBrowser.Document.SelectItem(null, 0);
    }

    function CreateAlbum()
    {
        var items = external.Property("Selected Items");
        if ((!items || items.Count() == 0) && (WebBrowser.Document.SelectedItems().Count == 0))
            alert(L_SelectSomePics_Text);
        else
            GoTo("Email Album");
        return false;
    }

    function MorePictures()
    {
        GoTo("Choose Folder");
        return false;
    }
</SCRIPT>

<SCRIPT FOR=WebBrowser EVENT=DocumentComplete>
    var doc = WebBrowser.Document;
    FolderViewEvents.SetFolderView(doc);
    FolderTitle.innerText = doc.Folder.Title;
    RestoreSelection();
</SCRIPT>

<script FOR=FolderViewEvents EVENT=SelectionChanged>
</script>

<script FOR=FolderViewEvents EVENT="DefaultVerbInvoked">
    return false;
</script>

<OBJECT ID=FolderViewEvents CLASSID="CLSID:9BA05971-F6A8-11CF-A442-00A0C90A8F39"></OBJECT>

</HEAD>

<BODY>

<!-- background image -->

<IMG SRC="images/stripes.gif" CLASS="backgroundimage">

<!-- page content -->
<TABLE CLASS="PageContentTable">
    <!-- logo -->
    <TR CLASS="PageTitleRow">
        <TD CLASS="PageLeftSpacer">&nbsp</TD>
        <TD CLASS="title"><ID id="PageTitle">Choose the pictures you want to e-mail</ID></TD>
    </TR>

    <!-- main content -->
    <TR CLASS="PageContentRow">
        <TD CLASS="PageLeftSpacer">&nbsp</TD>
        <TD CLASS="PageContentCell">
            <TABLE CLASS="ContentDividerTable">
                <TR CLASS="ContentDividerRow">
                    <!-- tasks -->
                    <TD CLASS="LeftContentCell">
                        <TABLE CLASS="textSecondary">
                            <TR>
                                <TD CLASS="textPrimary" ID=Instruction1 colspan=2>To choose pictures:<p></td>
                            </TR>
                            <TR>
                                <TD ID=idStep1>1.</TD>
                                <TD ID=Instruction2>On the right, click the pictures you want to include.<p></TD>
                            </TR>
                            <TR>
                                <TD ID=idStep2>2.</TD>
                                <TD ID=Instruction3>If you  want to include pictures from another folder, click:
                                    <p><A ID=ChooseMore HREF="" ONCLICK="return MorePictures();"><ID ID=Task2>Choose more pictures.</ID></A><p>
                                </TD>
                            </TR>
                            <TR>
                                <TD ID=idStep3>3.</TD>
                                <TD ID=Instruction4>When you have finished choosing pictures, click:
                                    <p><A ID=CreateAlbum HREF="" ONCLICK="return CreateAlbum();"><ID ID=Task1>Choose e-mail addresses</ID></A><p>
                                </TD>
                            </TR>
                        </TABLE>
                    </TD>

                    <!-- other content -->
                    <TD CLASS="RightContentCell" id=NamespaceArea style="padding: 0; margin: 0; border:0">
                        <TABLE style="width: 100%; height: 100%;" CELLSPACING=0>
                            <TR STYLE="background-color: #B8DEF9;">
                                <TD ID=FolderTitle CLASS="headerSecondary" STYLE="background-color: #B8DEF9; padding: 15 15 0 15">
                                    &nbsp;
                                </TD>
                            </TR>
                            <TR style="height:100%; background-color: #B8DEF9">
                                <TD STYLE="background-color: #B8DEF9; padding: 0 15 15 15">
                                <OBJECT ID=WebBrowser CLASSID="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2" style="height:100%; width: 100%; background-color: #B8DEF9">
                                    <PARAM NAME="NoWebView" VALUE="1">      <!-- turn off webview in defview -->
                                    <PARAM NAME="HideFileNames" VALUE="1">  <!-- hide filenames in defview -->
                                    <PARAM NAME="NoClientEdge" VALUE="1">   <!-- flat edge around defview (not working?) -->
                                    <PARAM NAME="ViewID" VALUE="{8BEBB290-52D0-11d0-B7F4-00C04FD706EC}">  <!-- thumbnail view -->
                                    <PARAM NAME="NoFolders" VALUE="1">
                                    <PARAM NAME="Select Mode" VALUE="1">    <!-- tell thumbview we want select mode -->
                                    <PARAM NAME="Transparent" VALUE="1">
                                </OBJECT>
                                </TD>
                            </TR>
                            <TR>
                                <TD style="padding: 10 15 0 15;">
                                <BUTTON ID=btnSelectAll ONCLICK="SelectAll()"><ID ID=dummy1>Select All</ID></BUTTON>
                                <BUTTON ID=btnUnselectAll ONCLICK="UnselectAll()"><ID ID=dummy2>Unselect All</ID></BUTTON>
                                </TD>
                            </TR>
                        </TABLE>
                    </TD>
                </TR>
            </TABLE>
        </TD>
    </TR>
</TABLE>
</BODY>
</HTML>
