<HTML>
<HEAD>
<LINK REL="stylesheet" HREF="photo.css" TYPE="text/css">
<TITLE>Get pictures from your camera</TITLE>
<SCRIPT DEFER SRC="photoctr.js"></SCRIPT>

<SCRIPT DEFER>
ThisPlace = "Get Pictures";
ThisPanel = "GetPics";

var g_strDisplayName;
var g_strDeviceId;
var g_strFriendlyName;

// ask browser control in Namespace panel to browse into the selected camera folder
function OnBeforePlaceTransition(From, To)
{
    if (To == "camera")
    {
        g_strDisplayName = external.Property("SelectedWiaDeviceDisplayName");
        g_strDeviceId = external.Property("SelectedWiaDeviceId");
        g_strFriendlyName = external.Property("SelectedWiaDeviceFriendlyName");

        external.panels.panel("Namespace").content.all.WebBrowser.Navigate(g_strDisplayName);
    }
}

</SCRIPT>

<SCRIPT for=window event=onload>
    external.event.registerSink("Place.BeginTransition", OnBeforePlaceTransition, false);
</SCRIPT>

<SCRIPT>
var L_ErrorMsg_TEXT = "Operation failed!";

function GetPictures()
{
    var oBrowser = external.panels.panel("Namespace").content.all.WebBrowser;
    var srcfldr = oBrowser.Document.Folder;

    var shell = new ActiveXObject("Shell.Application");
    var dstfldr = shell.NameSpace("shell:My Pictures");

    // create a new folder under shell:My Pictures if the user specified one
    if (txtDestFolder.value != "")
    {
        dstfldr.NewFolder(txtDestFolder.value);

        var dstfldritem = dstfldr.ParseName(txtDestFolder.value);
        if ((dstfldritem != null) && dstfldritem.IsFolder())
            dstfldr = dstfldritem.GetFolder();
        else
           ; // bugbug: is this reasonable?
    }

    if ((srcfldr != null) && (dstfldr != null))
    {
        if (cbDelete.checked)
            dstfldr.MoveHere(srcfldr.Items());
        else
            dstfldr.CopyHere(srcfldr.Items());

        // navigate browser control into destination folder
        oBrowser.Navigate2(dstfldr.Self);
        AddToRecentPictures(dstfldr.Self);
       
        // then go to my pictures page to edit/view it
        GoTo("My Pictures");
    }
    else
    {
        alert(L_ErrorMsg_TEXT);
    }
}

</SCRIPT>

</HEAD>

<BODY>
<!-- background image -->

<IMG SRC="images/stripes.gif" CLASS="backgroundimage">

<!-- page content -->
<TABLE CLASS="PageContentTable">
    <!-- logo -->
    <TR CLASS="PageTitleRow">
        <TD CLASS="PageLeftSpacer">&nbsp</TD>
        <TD CLASS="title" id="PageTitle">Get pictures from your camera</TD>
    </TR>

    <!-- main content -->
    <TR CLASS="PageContentRow">
        <TD CLASS="PageLeftSpacer">&nbsp</TD>
        <TD CLASS="PageContentCell">
            <TABLE CLASS="ContentDividerTable">
                <TR CLASS="ContentDividerRow">
                    <!-- tasks -->
                    <TD CLASS="LeftContentCell">
                        <TABLE STYLE="height:100%">
                            <TR>
                                <TD COLSPAN=2>
                                    <SPAN CLASS="textPrimary"><ID="CommandTitle">To get pictures from your camera:</ID></SPAN><BR>
                                </TD>
                            </TR>
                            <TR>
                                <TD COLSPAN=2>
                                    <SPAN CLASS="textSecondary">
                                        <OL STYLE="list-style-position: outside;">
                                            <LI ID=step1>
                                                Type a name for the folder where you want to save your pictures:<P>
                                                <INPUT ID=txtDestFolder TYPE=TEXT MAXSIZE=255 STYLE="width:80%"/><P>
                                            </LI>
                                            <LI ID=step2>
                                                Click <B>Get Pictures.</B><P>
                                                <BUTTON ID=btnGetPictures ONCLICK="GetPictures();" ACCESSKEY="G"><U>G</U>et Pictures</BUTTON>
                                            </LI>
                                        </OL>
                                    </SPAN>
                                </TD>
                            </TR>
                            <TR>
                                <TD><INPUT ID=cbDelete TYPE=CHECKBOX CHECKED /></TD>
                                <TD><LABEL ID=idText1 FOR=cbDelete CLASS="textSecondary" ACCESSKEY="D"><U>D</U>elete pictures from my camera after saving them to my computer</LABEL></TD>
                            </TR>
                        </TABLE>
                    </TD>

                    <!-- other content -->
                    <TD CLASS="RightContentCell" id=Master STYLE="behavior: url(..\common\master.htc);" slave="Namespace">
                    </TD>
                </TR>
            </TABLE>
        </TD>
    </TR>
</TABLE>
</BODY>
</HTML>
