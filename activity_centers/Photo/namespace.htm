<HTML>
<HEAD>
<LINK REL="stylesheet" HREF="photo.css" TYPE="text/css">
<TITLE>My Pictures Place</TITLE>
<STYLE>
.PreviewShown
{
    width:  100%;
    height: 100%;
    margin: 2;
}

.PreviewHidden
{
    display: none;
    width:  100%;
    height: 100%;
    margin: 2;
}

.ThumbStrip
{
    width:  100%;
    height: 110px;
    margin: 2;
}

.BrowserFull
{
    width:  100%;
    height: 100%;
    margin: 2;
}

.Toolbar
{
    width: 100%;
    border: 1px solid black;
    background: buttonface;
}

.TBBtn
{
    padding: 0;
    margin: 0;
    behavior: url(..\common\button.htc);
}

.TB_static
{
    background: buttonface;
    border: 2 solid buttonface;
}

.TB_hover
{
    background: buttonface;
    border: 2 outset white;
}

.TB_active
{
    background: buttonhighlight;
    border: 2 inset white;
}

IMG, TR, TD
{
    padding: 0;
    margin: 0;
}
</STYLE>
<SCRIPT DEFER SRC="photoctr.js"></SCRIPT>
<SCRIPT>
    external.event.registerSink("Place.TransitionComplete", OnTransitionComplete, false);
    var bPreviewOn = false;

    function gotoPreviewMode(bOn)
    {
      if ( bPreviewOn == bOn )
        return;

      if ( bOn ) {
        BrowserRow.className = "ThumbStrip";
        PreviewRow.className = "PreviewShown";
        WebBrowser.PutProperty("AlignLeft", 1);
        bPreviewOn = true;
      } else {
        PreviewRow.className = "PreviewHidden";
        BrowserRow.className = "BrowserFull";
        WebBrowser.PutProperty("AlignLeft", 0);
        bPreviewOn = false;
      }
    }

    function FormatNumber(n)
    {
        var s = "";
        var i, j = 0;
        for (i = n.length - 1; i >= 0; i--) {
            s = n.charAt(i) + s;
            if (i && ((++j % 3) == 0))
                s = L_Delimiter_Text + s;
        }
        return s;
    }

    function HandleSize(item, doc)
    {
        var L_Bytes_Text        = " bytes";

        var s = "";
        var size = item.Size;
        if (size && size < 1000)
            s = size + L_Bytes_Text;
        else {
            var data = doc.Folder.GetDetailsOf(item, 1);
            if (data)
                s = data;
            else if (size)
                s = FormatNumber(size.toString()) + L_Bytes_Text;
        }
        return s;
    }

    function ShowProps(item, doc)
    {
        var L_DateCreated_Text  = "Date Created: ";
        FileName.innerText = item.Name;

        // There are three ways to present the Created date:
        // 1.) This gives an ugly string which I don't even think follows proper locale syntax
        //      CreateDate.innerText = item.ExtendedProperty("Created");

        // 2.) This follows locale settings but its still ugly and is in GMT with 24 hour clock
        //      var d = new Date(item.ExtendedProperty("Created"));
        //      CreateDate.innerText = d.toLocaleString();

        // 3.) This is ugly code but it gives the same result as what we display in the explorer
        CreateDate.innerText = L_DateCreated_Text + doc.Folder.GetDetailsOf(item, 6);

        FileSize.innerText = HandleSize(item, doc);
    }

    function OnTransitionComplete(From, To)
    {
        if ( "Rotate" == To || "camera" == To)
        {
            ToolBar.style.display = "none";
        }
        else if ( "Rotate" == From || "camera" == From)
        {
            ToolBar.style.display = "";
        }
    }
</SCRIPT>

<SCRIPT FOR=WebBrowser EVENT=DocumentComplete>
    var doc = WebBrowser.Document;
    FolderViewEvents.SetFolderView(doc);
    FolderTitle.innerText = doc.Folder.Title;
    WebBrowser.PutProperty("AlignLeft", bPreviewOn?1:0);
</SCRIPT>

<script FOR=FolderViewEvents EVENT="DefaultVerbInvoked">
    var sel = WebBrowser.Document.SelectedItems();
    var item = sel.Item(0);
    var L_NotFileSystem_Text = "Can only rotate file system objects at the moment...";

    if ( item.IsFolder )
    {
        WebBrowser.Navigate2(item);
        AddToRecentPictures(item);
    }
    else
    {
        Preview.Show(item);
        ShowProps(item, WebBrowser.Document);
        if (external.places.currentPlace.name == "Rotate")
        {
            if (item.IsFileSystem)
            {
                var path = item.Path;
                var ext = GetFileExtension(path);

                if (ext != "tif" && ext != "tiff")
                {
                    var targetDoc = external.panels.panel("Rotate").content.all;
                    targetDoc.Edit.Rotate(path, "");
                    targetDoc.save.disabled = false;
                }
                else
                    alert(L_NotEditableFormat_Text);
            }
            else
                alert(L_NotFileSystem_Text);
        }
        else
        {
            gotoPreviewMode(true);
        }
    }

    return false;
</script>

<script FOR=FolderViewEvents EVENT="SelectionChanged">
    var doc = WebBrowser.Document;
    var sel = doc.SelectedItems();
    if (sel.Count >= 1)
    {
        var luckyGuy = doc.FocusedItem;
        Preview.Show(luckyGuy);
        ShowProps(luckyGuy, doc);
        external.Property("Current Editing Image") = luckyGuy;
    }

    return false;
</script>

<script for=window event=onload>
    // We create this "shown" to prevent delayed window creation, but then we hide it right away
    PreviewRow.className = "PreviewHidden";
</script>

<OBJECT ID=FolderViewEvents CLASSID="CLSID:9BA05971-F6A8-11CF-A442-00A0C90A8F39">
</OBJECT>

</HEAD>

<BODY style="margin: 5; background-color: #B8DEF9;">
    <!-- page content -->
    <TABLE style="height:100%; width:100%;">
        <TR>
            <TD ID=FolderTitle CLASS="headerSecondary"></TD>
        </TR>
        <TR ID=ToolBar CLASS=Toolbar>
            <TD CLASS=Toolbar>
                <TABLE>
                    <TR>
                        <!-- BUGBUG: These should be button tags but I couldn't get the styles and behaviors to work with buttons -->
                        <TD CLASS="TBBtn TB_static" ID=Btn1 ONCLICK="gotoPreviewMode(!bPreviewOn)" TITLE="Toggle View" style="padding:0 2">
                            <IMG SRC="images/preview_static.gif" style="float:left">
                            <SPAN CLASS="textTertiary"><ID ID="prevtext">Preview</ID></SPAN>
                        </TD>
                        <TD style="border-width: 1; border-style: inset; width: 1; font-size: 1">&nbsp;</TD>
                        <TD CLASS="TBBtn TB_static" ID=Btn3 ONCLICK="gotoPreviewMode(true); Preview.ActualSize()" TITLE="Actual Size">
                            <IMG SRC="images/actualsize_static.gif">
                        </TD>
                        <TD CLASS="TBBtn TB_static" ID=Btn4 ONCLICK="gotoPreviewMode(true); Preview.BestFit()" TITLE="Best Fit">
                            <IMG SRC="images/bestfit_static.gif">
                        </TD>
                        <TD CLASS="TBBtn TB_static" ID=Btn5 ONCLICK="gotoPreviewMode(true); Preview.Zoom(1)" TITLE="Zoom In">
                            <IMG SRC="images/zoomin_static.gif">
                        </TD>
                        <TD CLASS="TBBtn TB_static" ID=Btn6 ONCLICK="gotoPreviewMode(true); Preview.Zoom(-1)" TITLE="Zoom Out">
                            <IMG SRC="images/zoomout_static.gif">
                        </TD>
                    </TR>
                </TABLE>
            </TD>
        </TR>
        <TR ID=PreviewRow CLASS=PreviewShown>
            <TD style="height: 100%; width: 100%">
                <OBJECT ID=Preview style="height: 100%; width: 100%" CLASSID="CLSID:50F16B26-467E-11D1-8271-00C04FC3183B">
                    <PARAM NAME="Toolbar" VALUE="0">
                    <PARAM NAME="Print Button" VALUE="1">
                </OBJECT>
            </TD>
        </TR>
        <TR ID=BrowserRow CLASS=BrowserFull>
            <TD>
                <OBJECT ID=WebBrowser style="height: 100%; width: 100%" CLASSID="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2">
                    <PARAM NAME="NoWebView" VALUE="1">      <!-- turn off webview in defview -->
                    <PARAM NAME="HideFileNames" VALUE="1">  <!-- hide filenames in defview -->
                    <PARAM NAME="NoClientEdge" VALUE="1">   <!-- flat edge around defview -->
                    <PARAM NAME="ViewID" VALUE="{8BEBB290-52D0-11d0-B7F4-00C04FD706EC}">  <!-- thumbnail view -->
                    <PARAM NAME="Location" VALUE="shell:My Pictures">
                    <PARAM NAME="Transparent" VALUE="1">    <!-- use ambient background color -->
                    <PARAM NAME="NoFolders" VALUE="1">
                </OBJECT>
            </TD>
        </TR>
        <TR>
            <TD>
                <TABLE STYLE="width: 100%">
                    <TR>
                        <TD ID=FileName CLASS="textTertiary">&nbsp;</TD>
                        <TD ID=CreateDate CLASS="textTertiary">&nbsp;</TD>
                    </TR>
                    <TR>
                        <TD ID=FileSize CLASS="textTertiary">&nbsp;</TD><TD>&nbsp;</TD>
                    </TR>
                </TABLE>
            </TD>
        </TR>
    </TABLE>
</BODY>
</HTML>
