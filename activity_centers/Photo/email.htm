<HTML>
<HEAD>
<LINK REL="stylesheet" HREF="photo.css" TYPE="text/css">
<TITLE>Email Album</TITLE>
<SCRIPT DEFER SRC="photoctr.js"></SCRIPT>
<SCRIPT>
    external.event.registerSink("Place.TransitionComplete", OnAfterPlaceTransition, false);

    //var L_Body_TEXT = "You have received a photo album!  To see it, click the Index.htm file.";
    var L_Error_TEXT = "Windows could not send your photo album.";
    
    function Send()
    {
        if (txtTo.value != "")
        {
            var strTo = new String(txtTo.value);
            var recipients = strTo.split(";");
            var bSuccess = true;

            try
            {
                WebBrowser.Document.SendEmail("", txtBody.value, recipients);
            }
            catch (e)
            {
                bSuccess = false;
            }

            if (bSuccess)
            {
                var place = external.Property("Email Start Place");

                external.Property("Selected Items") = null;
                txtTo.value = "";
                txtBody.value = "";
                if (place)
                    GoTo(place);
            }
            else
            {
                alert(L_Error_TEXT);
            }
        }
    }

    function InsertPictures()
    {
        var ilPhotos = external.Property("Selected Items");

        if (ilPhotos)
        {
            var i;
            var pictures = new Array();
            
            for (i=0; i<ilPhotos.Count(); i++) //>
            {
                pictures[i] = ilPhotos.Item(i).Path;
            }

            WebBrowser.Document.PopulateWithPictures(pictures);
        }
    }
    
    function OnAfterPlaceTransition(Form, To)
    {
        if (To == "Email Album")
        {
            // csidl_windows == 36
            WebBrowser.Navigate("file://" + external.shell.Namespace(36).Self.Path + "\\Activity\\Photo\\dummy.mpmhp");
            //InsertPictures();
        }
    }
</SCRIPT>

<SCRIPT for=window event=onload>
</SCRIPT>

<script for=WebBrowser EVENT=DocumentComplete>
    WebBrowser.Document.SelectTemplate(external.shell.Namespace(36).Self.Path + "\\Activity\\Photo\\8images_200_beta1.mhp");
    InsertPictures();
</script>
</HEAD>

<BODY>

<!-- background image -->

<IMG SRC="images/stripes.gif" CLASS="backgroundimage">

<!-- page content -->
<TABLE ID=PageContentTable CLASS="PageContentTable">
    <!-- page title -->
    <TR ID=PageTitleRow CLASS="PageTitleRow">
        <TD CLASS="PageLeftSpacer">&nbsp</TD>
        <TD ID=PageTitleCell CLASS="title">Send your pictures</TD>
    </TR>

    <!-- main content -->
    <TR ID=PageContentRow CLASS="PageContentRow">
        <TD CLASS="PageLeftSpacer">&nbsp</TD>
        <TD ID=PageContentCell CLASS="PageContentCell">
            <TABLE ID=ContentDividerTable CLASS="ContentDividerTable">
                <TR ID=ContentDividerRow CLASS="ContentDividerRow">
                    <!-- task list -->
                    <TD ID=LeftContentCell CLASS="LeftContentCell">
                        <TABLE STYLE="width: 100%; height: 100%" CLASS="textSecondary">
                            <TR STYLE="width: 100%;">
                                <TD ID=aaa>1.</TD>
                                <TD>
                                    <ID ID=step1>Type the e-mail addresses of the people you want to send your pictures to. Put a semicolon between each address.</ID>
                                    <P>
                                    <INPUT TYPE=text VALUE="" ID=txtTo STYLE="width: 100%"></INPUT>
                                    <P>
                                </TD>
                            </TR>
                            <TR STYLE="width: 100%;">
                                <TD ID=bbb>2.</TD>
                                <TD>
                                    <ID ID=step2>Type a message to include with your pictures.</ID>
                                    <P>
                                    <TEXTAREA ID=txtBody STYLE="width:100%;" ROWS=6></TEXTAREA>
                                    <BR>
                                </TD>
                            </TR>
                            <TR STYLE="width: 100%; height=100%; vertical-align: top">
                                <TD ID=ccc>3.</TD>
                                <TD>
                                    <ID ID=step3>Click <B>Send</B>.</ID>
                                    <P>
                                    <BUTTON ID=btnSend ONCLICK="Send();"><ID ID=dummy>Send</ID></BUTTON><br>
                                </TD>
                            </TR>
                        </TABLE>
                    </TD>

                    <!-- other content -->
                    <TD CLASS="RightContentCell">
                          <OBJECT ID="WebBrowser" CLASSID="clsid:8856F961-340A-11D0-A96B-00C04FD705A2" STYLE="width: 100%; height: 100%">
                              <PARAM NAME="AutoArrange" VALUE="1">
                              <PARAM NAME="NoClientEdge" VALUE="0">
                              <PARAM NAME="ViewID" VALUE="{A1ABDA67-5FB8-487C-9B5C-D7D3EEE179FE}">
                              <PARAM NAME="Transparent" VALUE="1">
                              <!--PARAM NAME="LOCATION" VALUE="file://d:\winnt\activity\photo\dummy.mpmhp"-->
                          </OBJECT>
                    </TD>
                </TR>
            </TABLE>
        </TD>
    </TR>
</TABLE>
</BODY>
</HTML>
