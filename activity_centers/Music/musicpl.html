<HTML>
    <HEAD>
        <LINK REL="stylesheet" TYPE="text/css" HREF="music.css">
        </LINK>
        <TITLE>
            <ID=idTitle>My music Playlist</ID>
        </TITLE>
        <SCRIPT SRC="musicctr.js">
        </SCRIPT>
    </HEAD>

    <SCRIPT>
    var s_CurMusicPlaylist = null;
    var s_iTotalPlaytime = 0;
    var L_NewPlaylist = "New Playlist";
    
    function UpdatePlaylistDisplay(Playlist)
    {
        var i;
        
        // First remove the existing tracks
        ID_SelectedSongs.innerHTML = "";
        
        //Now, add the tracks from the playlist.
        for(i = 0; i < Playlist.Tracks; i++)
        {
            ID_SelectedSongs.innerHTML += "<BR>"+Playlist.GetTrackProperty(i, "Title");
        }
        
        CountOfSongs.innerText = i; //i now contains the total number of songs.
        //Enable the Change your playlist button.
        lnkChangeYourPlaylist.className = "tasksub";
    }
    
    function InitMusicPlaylist()
    {
        var player = external.Property("Player");
        var fNew = external.Property("fNewPlaylist");
        if(fNew == 1)
        {
            s_CurMusicPlaylist = player.NewPlaylist;
            NewPlaylist.innerText = L_NewPlaylist;
            external.Property("fNewPlaylist") = 0; 
            external.Property("ObjCurMusicPlaylist")= s_CurMusicPlaylist;
            external.Property("CurMusicPlaylistName")="";
        }
        else
        {
            s_CurMusicPlaylist = external.Property("ObjCurMusicPlaylist");
            //Change the "New playlist" text with the playlist name.
            var Name = external.Property("CurMusicPlaylistName");
            if(Name != "")
                NewPlaylist.innerText = Name;
            else
                NewPlaylist.innerText = L_NewPlaylist;
        }
        //Initialize the listbox with the items in the playlist.
        UpdatePlaylistDisplay(s_CurMusicPlaylist);
    }
    
    function OnMusicFile()
    {
        var item = NameSpace.selectedItem;
        if (item && !item.isFolder)
        {
            s_CurMusicPlaylist.InsertTrack(item.path, -1);
            var iTrackIndex = s_CurMusicPlaylist.Tracks - 1;
            //BUGBUG: Getting the "Title" does not work! Getting the filename instead.
            //var Title = s_CurMusicPlaylist.GetTrackProperty(iTrackIndex, "Filename");
            var Title = item.Name;
            var elem = document.all.item("ID_SelectedSongs");
            
            if(elem)
            {
                elem.innerHTML += "<BR>"+Title;
            }
            
            var elemCount = document.all.item("CountOfSongs");
            if(elemCount)
                elemCount.innerText = (iTrackIndex+1);

            //BUGBUG:#100493 The duration property may not be available for all the tracks.
            var iPlayTimeForSong = s_CurMusicPlaylist.GetTrackProperty(iTrackIndex, "Duration");
            if(iPlayTimeForSong)
                s_iTotalPlaytime += iPlayTimeForSong; 
            var elemTotalPlaytime = document.all.item("TotalPlaytime");
            if(elemTotalPlaytime)
                elemTotalPlaytime.innerText = FormatDurationInfo(s_iTotalPlaytime);
            //Enable the "Done" button.
//            btnDone.disabled = false;
            //Enable the Change your playlist button.
            lnkChangeYourPlaylist.className = "tasksub";
        }
    }
    
    function ChangeYourPlaylist()
    {
        external.Property("ObjCurMusicPlaylist") = s_CurMusicPlaylist;
    }
    
    function OnTransitionComplete(from, to)
    {
        // We need to initialize the listbox everytime we transition to this page because the
        // list could have changed in other places.
        if(to == "MusicPlaylist")
            InitMusicPlaylist();
    }
    
    function Init()
    {
        external.event.registerSink("Place.TransitionComplete", OnTransitionComplete, true);
    }

</SCRIPT>

<SCRIPT language="JavaScript" for="NameSpace" event="SelectionChange">
    OnMusicFile();
</SCRIPT>

<SCRIPT language="JavaScript" for="NameSpace" event="DoubleClick">
    OnMusicFile();
</SCRIPT>

<SCRIPT language="Javascript" for="lnkChangeYourPlaylist" event="onclick">
    if(event.srcElement.className == "tasksub")
    {
        ChangeYourPlaylist();
        return GoTo('EditPlaylist');
    }
    else
        return GoTo('');
</SCRIPT>

    <BODY SCROLL="no" ONLOAD="Init();InitMusicPlaylist()"><!-- background images -->
        <DIV CLASS="bottomleftimage">
        <TABLE CLASS="fullpage" ONRESIZE="PositionPlayer();">
            <TR STYLE="WIDTH:100%;">
                <TD CLASS="aligntop" STYLE="WIDTH:100%;">
                    <TABLE STYLE="WIDTH:100%;">
                        <TR STYLE="HEIGHT: 25px">
                            <TD STYLE="WIDTH: 46px"> <!--empty column -->
                            </TD>
                        </TR><!-- page content -->
                        <TR>
                            <TD>    <!--empty column-->
                            </TD>
                            <TD>
                                <DIV CLASS="commandtitle">
                                    <ID  ID=IDINSERTCD>Choose music for your playlist </ID>
                                </DIV>
                            </TD>
                        </TR>
                        
                        <TR  STYLE="HEIGHT: 15px">  <!-- Empty row -->
                            <TD>    <!-- Empty Column -->
                            </TD>
                        </TR>
                        
                        <TR CLASS="rowaboveplayer">
                            <TD>    <!-- Empty Column -->
                            </TD>
                            <TD> <!-- This column has a table divided into three columns -->
                                <TABLE STYLE="HEIGHT: 100%; WIDTH:100%">
                                    <TR>
                                        <TD STYLE="WIDTH:25%" valign="top">
                                            <TABLE>
                                                <TR>
                                                    <TD valign="top">
                                                        <TABLE>
                                                            <TR>
                                                                <TD valign="baseline" CLASS="verysmallinstructions"><ID ID="L_1">1.</ID>
                                                                </TD>
                                                                <TD>
                                                                    <DIV ID="ClickAnArtist" CLASS="verysmallinstructions">Click an artist, album or playlist to expand it.</DIV>
                                                                    <BR>
                                                                </TD>
                                                            </TR>
                                                            <TR>
                                                                <TD valign="baseline" CLASS="verysmallinstructions"><ID ID="L_2">2.</ID>
                                                                </TD>
                                                                <TD>
                                                                    <DIV ID="ClickATrack" CLASS="verysmallinstructions">Click a track to select it for the playlist.</DIV>
                                                                    <BR>
                                                                </TD>
                                                            </TR>
                                                            <TR>
                                                                <TD valign="baseline" CLASS="verysmallinstructions"><ID ID="L_3">3.</ID>
                                                                </TD>
                                                                <TD>
                                                                    <DIV ID="ClickDone" CLASS="verysmallinstructions">Click <B>Done</B>.</DIV>
                                                                </TD>
                                                            </TR>
                                                        </TABLE>
                                                    </TD>
                                                </TR>
                                                <TR>
                                                    <TD STYLE="height:30px">
                                                    </TD>
                                                </TR>
                                                <TR>
                                                    <TD>
                                                        <SPAN CLASS="smallinstructionstitle"> <ID ID="AlsoText">You can also:</ID>
                                                        </SPAN>
                                                        <BR>
                                                        <SPAN CLASS="alsotext">
                                                            <A ID="change_a_playlist" ONCLICK="return GoTo('ChoosePlaylist')" HREF=""><ID ID="Change_a_plist">Change a playlist</ID></A>
                                                            <BR>
                                                            <A ID="Open_my_music" CLASS="tasksubdisabled" ONCLICK="return GoTo('')" HREF=""><ID ID="Open_My_Folder">Open My Music folder</ID></A>
                                                        </SPAN>
                                                    </TD>
                                                </TR>
                                            </TABLE>
                                        </TD>
                                        <TD>
                                            <TABLE STYLE="WIDTH:100%;HEIGHT:100%">
                                                <TD STYLE="WIDTH:45%;">
                                                    <TABLE valign="top" STYLE="WIDTH:100%;HEIGHT:100%">
                                                        <TR STYLE="HEIGHT:70%;background-color:#b8def9">
                                                            <TD COLSPAN=2>
                                                                <DIV STYLE="background-color:#b8def9">
                                                                    <OBJECT ID=NameSpace CLASSID="clsid:55136805-B2DE-11D1-B9F2-00A0C98BC547" WIDTH=100% height=100%>
                                                                        <PARAM NAME="root" VALUE="shell:::{A77BADF8-BD51-4b4d-B224-21802ED9695D}"> <!--"shell:drivefolder"-->
                                                                        <PARAM NAME="mode" VALUE="9"> <!--  9 -->
                                                                        <PARAM NAME="flags" VALUE="6"> <!-- 6 single select, single expand. -->
                                                                        <PARAM NAME="enumoptions" VALUE="-1">
                                                                        <PARAM NAME="columns" VALUE="name;type;size">
                                                                    </OBJECT>
                                                                </DIV>
                                                            </TD>
                                                        </TR>
                                                        <TR STYLE="HEIGHT:5%">
                                                            <TD valign="top" align="left">
                                                               <TABLE>
                                                                    <TR>
                                                                        <TD> <DIV ID="status" CLASS="alsotext" align="left">Status:&nbsp</DIV> </TD>
                                                                        <TD> <DIV ID="CountOfSongs" CLASS="alsotext">0</DIV></TD>
                                                                        <TD> <DIV ID="songsSelected" CLASS="alsotext">&nbspsong(s) selected</DIV></TD>
                                                                    </TR>
                                                                </TABLE>
                                                            </TD>
                                                            <TD valign="top" align="right">
                                                                <TABLE>
                                                                    <TR>
                                                                        <TD> <DIV ID="TotalPlay" CLASS="alsotextdisabled">Total playback time:&nbsp</DIV></TD>
                                                                        <TD> <DIV ID="TotalPlaytime" CLASS="alsotextdisabled">0:00</DIV></TD>
                                                                    </TR>
                                                                </TABLE>
                                                            </TD>
                                                        </TR>
                                                        <TR STYLE="HEIGHT:15px">
                                                            <TD>
                                                            </TD>
                                                        </TR>
                                                        <TR>
                                                            <TD valign="top">
                                                                <BUTTON id="btnDone" OnClick="return GoTo('SavePlaylist')">Done</BUTTON>
                                                            </TD>
                                                        </TR>
                                                    </TABLE>
                                                </TD>
                                                <TD STYLE="WIDTH:30%"> <!-- Contains New Playlist -->
                                                    <TABLE STYLE="WIDTH:100%; HEIGHT:100%">
                                                        <TR STYLE="HEIGHT:70%"> 
                                                            <TD STYLE="WIDTH:15px">
                                                            </TD>   
                                                            <TD valign="top" align="left">
                                                                <DIV CLASS="SelectedSongs">
                                                                    <DIV ID="NewPlaylist" CLASS="alsotext"><U>New Playlist</U></DIV>
                                                                    <DIV ID="ID_SelectedSongs"></DIV>
                                                                </DIV>
                                                            </TD>
                                                            <TD STYLE="WIDTH:15px">
                                                            </TD>   
                                                        </TR>
                                                        <TR STYLE="HEIGHT:35%">    <!-- Contains the Buttons "Change your playlist" and "Done" -->
                                                            <TD>
                                                            </TD>
                                                            <TD valign="top">
                                                                <A ID="lnkChangeYourPlaylist" CLASS="tasksubdisabled" HREF=""><ID ID="idChangeYourPlaylist"> Change your playlist</ID></A>
                                                            </TD>
                                                        </TR>
                                                    </TABLE>
                                                </TD>
                                            </TABLE>
                                        </TD>
                                    </TR>
                                </TABLE>
                            </TD>
                        </TR>
                    </TABLE>
                </TD>
            </TR>
            <TR>
                <TD>
                    <DIV ID=Master CLASS="playercell">
                    </DIV>
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>

